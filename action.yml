name: Changelog Management
description: |
  Provides management tasks for changelogs in Keep a Changelog 1.0.0 format, 
  including updating for a release, reading data, and adding new changes.
branding:
  icon: list
  color: yellow
inputs:
  path:
    description: |
      Path to relative to the root of the project to a CHANGELOG.md file in Keep a 
      Changelog 1.0.0 format. Defaults to CHANGELOG.md in the root of the project.
    required: false
    default: CHANGELOG.md
  mode:
    description: |
      Mode for the action. Should be one of `readdata`, `release`, or `addchange`. 
      Defaults to `readdata`.
    required: false
    default: readdata
  releaseversion:
    description: |
      Version number to use when updating a changelog for release. Only valid for mode 
      `release`.
    required: false
  changetype:
    description: |
      Type of change to add. Should be one of `Added`, `Changed`, `Deprecated`, 
      `Removed`, `Fixed`, or `Security`. Only valid for mode `addchange`.
    required: false
  changevalue:
    description: |
      Data for the change to add. Should be a single line string.  Only valid for 
      mode `addchange`.
    required: false
outputs:
  lastversion:
    description: |
      The version number of the latest release in the changelog.
    value: ${{ steps.readdata.outputs.lastversion }}
  releasenotes:
    description: |
      Release notes composed of changes from the most recent release.
    value: ${{ steps.readdata.outputs.releasenotes }}
runs:
  using: composite
  steps:
    - name: Send Inputs to env
      run: |
        "INPUT_PATH=${{ inputs.path }}" | Out-File -FilePath $env:GITHUB_ENV -Encoding utf-8 -Append
        "INPUT_MODE=${{ inputs.mode }}" | Out-File -FilePath $env:GITHUB_ENV -Encoding utf-8 -Append
        "INPUT_RELEASEVERSION=${{ inputs.releaseversion }}" | Out-File -FilePath $env:GITHUB_ENV -Encoding utf-8 -Append
        "INPUT_CHANGETYPE=${{ inputs.changetype }}" | Out-File -FilePath $env:GITHUB_ENV -Encoding utf-8 -Append
        "INPUT_CHANGEVALUE=${{ inputs.changevalue }}" | Out-File -FilePath $env:GITHUB_ENV -Encoding utf-8 -Append
      shell: pwsh
    - name: Validate Inputs
      id: validateinputs
      run: src\steps\1_validateinputs.ps1
      shell: pwsh
    - name: Install Module
      id: installmodule
      run: src\steps\2_installmodule.ps1
      shell: pwsh
    - name: Add Change
      id: addchange
      run: src\steps\3_addchange.ps1
      shell: pwsh
    - name: Release
      id: release
      run: src\steps\4_release.ps1
      shell: pwsh
    - name: Read Data
      id: readdata
      run: src\steps\4_readdata.ps1
      shell: pwsh